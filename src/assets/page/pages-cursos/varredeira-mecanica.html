<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- importando CSS page-racs.css -->
    <link rel="stylesheet" href="/src/assets/css/page-racs.css">
    <script src="https://smtpjs.com/v3/smtp.js"></script>
</head>
<body class="class_body">
    <div id="div_body">
        <div id="div_header">
            <div id="div-img"><img id="logo" src="https://cestsegtrabalho.com.br/wp-content/uploads/2022/09/logo-e1663851774609.png"></div>
        </div>
        <h1>Varredeira Mecânica</h1>
        <h2>Baixe a apostila e depois faça a prova.</h2>
        <div id="div_baixar_fazerprova">
            <img src="/src/assets/img/Varredeira-Mecanica.png" alt="" id="img_losang_rac1a10">
            <div>
                <a href="/src/assets/pdf/Varredeira Mecânica Apostila.pdf"><button id="btn_baixar">Baixar Apostila</button></a>
                <button id="btn_prova" onclick="ExibirElementOculto()">Fazer Prova</button>
            </div>
            <div id="formProva">
                <h3><b>Preencha os dados abaixo e faça a prova <br>
                    Nota mínima 80% <br>
                    Após aprovação já está registrado</h3><br>
                <form id="submit" action="#" name="form-contact">
                    <input type="text" id="name" placeholder="Nome completo:" required><br>
                    <input type="text" id="whatsapp" placeholder="Whatsapp:" required><br>
                    <input type="email" id="email" placeholder="Email:" required><br>
                    <input type="text" id="nome_empresa" placeholder="Nome da empresa: (Opcional)"><br>
                    <input type="text" id="cpf" placeholder="CPF:" required><br>
                    <br> Data <br>
                    <input type="date" id="data_Genilson"><br><br>
                    <input type="submit" value="Fazer Prova" id="submit">
                </form>
            </div>
                <a href="../racs.html"><button id="btn_voltar">Voltar</button></a>
            </div>
        </div>
    </div>

    <script>
        //mostra elemento oculto / oculta o elementro visivel
        function ExibirElementOculto() {
                    var display = document.getElementById('formProva').style.display;
                    if (display == "none") {
                        document.getElementById('formProva').style.display = 'block';
                    } else {
                        document.getElementById('formProva').style.display = 'none';
                    }
        }

        //LocalStorage
        function setLocalStorage() {
            localStorage.setItem("name", name.value)
            localStorage.setItem("cpf", cpf.value)
        }
        //Cria variáveis que recebem os valores dos inputs
        const name = document.getElementById('name');
        const whatsapp = document.getElementById('whatsapp');
        const email = document.getElementById('email');
        const nome_empresa = document.getElementById('nome_empresa');
        const cpf = document.getElementById('cpf');
        const datadehoje = document.getElementById('data');
        const submit = document.getElementById('submit');
        const dataGenilson = document.getElementById('data_Genilson');

        //atribui variavel ao arquivo global que pega nome e cpf
        nome_aluno = name

        //Pega dia e hora e coloca na variável dataAtual
        const data = new Date()
        const dia = String(data.getDate()).padStart(2, '0') //trasforma 1 em 01
        const mes = String(data.getMonth() + 1).padStart(2, '0') //trasforma 1 em 01
        const ano = data.getFullYear() // 2023
        const hora = String(data.getHours()).padStart(2, '0') //trasforma 1 em 01
        const minuto = String(data.getMinutes()).padStart(2, '0') //trasforma 1 em 01
        const segundo = String(data.getSeconds()).padStart(2, '0') //trasforma 1 em 01
        const dataAtual = `Aluno concluiu a prova em ${dia}/${mes}/${ano} às ${hora}:${minuto}:${segundo}`

        //corpo do email com tudo que será enviado para o Email
        submit.addEventListener('submit',(e)=>{
            e.preventDefault();
            let ebody = `
            <div><img src="https://cestsegtrabalho.com.br/wp-content/uploads/2022/09/logo-e1663851774609.png" width="100%"></div>
            <br><br>
            <h3>O aluno ${name.value} concluiu a prova de RAC 01 conforme treinamento com nota 10</h3>
            <br><br>
            <h3 style="margin: 0%;">Nome do aluno:</h3>${name.value}
            <br><br>
            <h3>Nome do curso: RAC 01</h3>
            <h3 style="margin: 0%;">Whatsapp do aluno:</h3>${whatsapp.value}
            <br><br>
            <h3 style="margin: 0%;">Email do aluno: </h3>${email.value}
            <br><br>
            <h3 style="margin: 0%;">CPF do aluno: </h3>${cpf.value}
            <br><br>
            <h3 style="margin: 0%;">Nome da Empresa (Opcional): </h3>${nome_empresa.value}
            <br><br>
            
            <br><br>
        <h3 style="font-weight: bold;">Data: </h3>${dataGenilson.value}
            `;

            Email.send({
                SecureToken : "58bc9bda-20b7-472d-9522-6edc923b7f69", //add your token here
                To : 'cestsegtrabalho@gmail.com', //pode colocar email.value e será enviado pro email ou colocar o email digitado mas ficará fixo
                From : "cestsegtrabalho@gmail.com", //email que enviará a mensagem para o usuário
                Subject : "O aluno concluiu a prova",
                Body : ebody
            }).then(
                window.location.href = '/src/provas/varredeira-mecanica.html', 
                setLocalStorage()
            );
        });
    </script>
</body>
</html>